<section class="faq-description-section">
  {% if collection.description != blank %}
    <div class="description-block text-white bg-blue-200 px-6 py-10 text-center">
      {% if section.settings.heading != blank %}
        <h2 class="text-2xl font-bold mb-4">{{ section.settings.heading }}</h2>
      {% endif %}
      <div class="collection-description text-base leading-relaxed max-w-3xl mx-auto">
        {{ collection.description }}
      </div>
    </div>
  {% endif %}

<div id="faq-accordion" class="accordion space-y-4">
  <p class="text-center text-gray-600">Loading FAQs...</p>
</div>
</section>

{% comment %}
  pass GIDs for JS fallback
{% endcomment %}
<script>
async function loadFaqs(gids) {
  if (!gids || gids.length === 0) return;

  const query = `
    query ($ids: [ID!]!) {
      nodes(ids: $ids) {
        ... on Metaobject {
          id
          fields {
            key
            value
          }
        }
      }
    }
  `;

  const response = await fetch("https://YOUR-SHOP.myshopify.com/api/2024-04/graphql.json", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Shopify-Storefront-Access-Token": "YOUR-STOREFRONT-ACCESS-TOKEN"
    },
    body: JSON.stringify({
      query,
      variables: { ids: gids }
    })
  });

  const json = await response.json();
  console.log("Fetched FAQ metaobjects: ", json.data.nodes);
  renderFaqs(json.data.nodes);
}

function renderFaqs(faqItems) {
  const container = document.getElementById("faq-accordion");
  if (!container) return;

  let html = "";
  faqItems.forEach((faq, idx) => {
    const question = faq.fields.find(f => f.key === 'question')?.value || '';
    const answer = faq.fields.find(f => f.key === 'answer')?.value || '';
    html += `
      <details class="border-b pb-3">
        <summary class="cursor-pointer font-semibold text-lg flex justify-between items-center">
          ${question}
          <span class="text-gray-500">â–¼</span>
        </summary>
        <div class="mt-2 text-gray-600">
          ${answer}
        </div>
      </details>
    `;
  });
  container.innerHTML = html;
}

if (window.faq_list) {
  loadFaqs(window.faq_list);
}
</script>

{% schema %}
{
  "name": "Collection desc and FAQ",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Main Heading",
      "default": "Best Selling Treatments And Serums"
    },
    {
      "type": "text",
      "id": "faq_heading",
      "label": "FAQ Heading",
      "default": "Frequently Asked Questions"
    }
  ],
  "presets": [
  {
    "name": "Collection desc with FAQ"
  }
]

}
{% endschema %}
